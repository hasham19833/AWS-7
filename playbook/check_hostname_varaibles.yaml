---
- name: Run one task per host based on v_method
  hosts: all
  gather_facts: true  # to get ansible_hostname; you can set false and use `hostname` command instead

  tasks:
    - name: Show free disk space
      ansible.builtin.command: "df -h"
      register: disk_out
      changed_when: false
      when: v_method == 'disk'

    - name: Print hostname
      ansible.builtin.debug:
        msg: "Hostname: {{ ansible_hostname | default(inventory_hostname) }}"
      when: v_method == 'name'

    # Optional: show what was executed (for clarity)
    - name: Summary per host
      ansible.builtin.debug:
        msg: >-
          {{ inventory_hostname }} ran method={{ v_method | default('name') }}
          {{ 'disk -> ' ~ (disk_out.stdout | default('')) if (v_method | default('name')) == 'disk' else 'name -> ' ~ (ansible_hostname | default(inventory_hostname)) }}
